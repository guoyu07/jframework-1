<!DOCTYPE html>

<html>
<head>
  <title>list.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="autodict.html">
                  autodict.coffee
                </a>
              
                
                <a class="source" href="autolist.html">
                  autolist.coffee
                </a>
              
                
                <a class="source" href="autovar.html">
                  autovar.coffee
                </a>
              
                
                <a class="source" href="components.html">
                  components.coffee
                </a>
              
                
                <a class="source" href="AreYouSure.html">
                  AreYouSure.coffee
                </a>
              
                
                <a class="source" href="Button.html">
                  Button.coffee
                </a>
              
                
                <a class="source" href="CancelButton.html">
                  CancelButton.coffee
                </a>
              
                
                <a class="source" href="DeleteButton.html">
                  DeleteButton.coffee
                </a>
              
                
                <a class="source" href="Dropdown.html">
                  Dropdown.coffee
                </a>
              
                
                <a class="source" href="EditButton.html">
                  EditButton.coffee
                </a>
              
                
                <a class="source" href="Expandable.html">
                  Expandable.coffee
                </a>
              
                
                <a class="source" href="KeyValueTable.html">
                  KeyValueTable.coffee
                </a>
              
                
                <a class="source" href="LinkButton.html">
                  LinkButton.coffee
                </a>
              
                
                <a class="source" href="Loader.html">
                  Loader.coffee
                </a>
              
                
                <a class="source" href="SubmitCancelDelete.html">
                  SubmitCancelDelete.coffee
                </a>
              
                
                <a class="source" href="TableRow.html">
                  TableRow.coffee
                </a>
              
                
                <a class="source" href="TextBox.html">
                  TextBox.coffee
                </a>
              
                
                <a class="source" href="denorm.html">
                  denorm.coffee
                </a>
              
                
                <a class="source" href="dict.html">
                  dict.coffee
                </a>
              
                
                <a class="source" href="dom.html">
                  dom.coffee
                </a>
              
                
                <a class="source" href="BooksDemo.html">
                  BooksDemo.coffee
                </a>
              
                
                <a class="source" href="SampleData.html">
                  SampleData.coffee
                </a>
              
                
                <a class="source" href="BatteryApi.html">
                  BatteryApi.coffee
                </a>
              
                
                <a class="source" href="ChatRoom.html">
                  ChatRoom.coffee
                </a>
              
                
                <a class="source" href="Home.html">
                  Home.coffee
                </a>
              
                
                <a class="source" href="Main.html">
                  Main.coffee
                </a>
              
                
                <a class="source" href="NotFound.html">
                  NotFound.coffee
                </a>
              
                
                <a class="source" href="chat.html">
                  chat.coffee
                </a>
              
                
                <a class="source" href="routes.html">
                  routes.coffee
                </a>
              
                
                <a class="source" href="main.html">
                  main.coffee
                </a>
              
                
                <a class="source" href="fetching.html">
                  fetching.coffee
                </a>
              
                
                <a class="source" href="j.html">
                  j.coffee
                </a>
              
                
                <a class="source" href="list.html">
                  list.coffee
                </a>
              
                
                <a class="source" href="models.html">
                  models.coffee
                </a>
              
                
                <a class="source" href="proptypes.html">
                  proptypes.coffee
                </a>
              
                
                <a class="source" href="publish.html">
                  publish.coffee
                </a>
              
                
                <a class="source" href="routing.html">
                  routing.coffee
                </a>
              
                
                <a class="source" href="autovar-tests.html">
                  autovar-tests.coffee
                </a>
              
                
                <a class="source" href="denorm-tests.html">
                  denorm-tests.coffee
                </a>
              
                
                <a class="source" href="dict-tests.html">
                  dict-tests.coffee
                </a>
              
                
                <a class="source" href="jframework-client-tests.html">
                  jframework-client-tests.coffee
                </a>
              
                
                <a class="source" href="jframework-tests.html">
                  jframework-tests.coffee
                </a>
              
                
                <a class="source" href="list-tests.html">
                  list-tests.coffee
                </a>
              
                
                <a class="source" href="publish-tests.html">
                  publish-tests.coffee
                </a>
              
                
                <a class="source" href="test-models.html">
                  test-models.coffee
                </a>
              
                
                <a class="source" href="util-tests.html">
                  util-tests.coffee
                </a>
              
                
                <a class="source" href="tracker.html">
                  tracker.coffee
                </a>
              
                
                <a class="source" href="util.html">
                  util.coffee
                </a>
              
                
                <a class="source" href="var.html">
                  var.coffee
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>list.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Copyright 2015, Quixey Inc.
All rights reserved.</p>
<p>Licensed under the Modified BSD License found in the
LICENSE file in the root directory of this source tree.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>TODO: Add a @observe() and @observeChanges() just like
Meteor’s collection API. Good for List and AutoList.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">J</span>.<span class="hljs-title">List</span></span>
    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(values, options)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Options:
    creator: The computation which “created”
        this List, which makes it inactive
        when it invalidates.
    tag: A toString-able object for debugging
    onChange: function(key, oldValue, newValue) or null
    fineGrained:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">unless</span> @ <span class="hljs-keyword">instanceof</span> J.List <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@_id</span>?
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> J.List values, options

        <span class="hljs-property">@_id</span> = J.getNextId()
        <span class="hljs-keyword">if</span> J.debugGraph <span class="hljs-keyword">then</span> J.graph[<span class="hljs-property">@_id</span>] = @

        <span class="hljs-property">@tag</span> = <span class="hljs-keyword">if</span> J.debugTags <span class="hljs-keyword">then</span> options?.tag <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>

        <span class="hljs-keyword">if</span> values <span class="hljs-keyword">instanceof</span> J.List
            <span class="hljs-property">@tag</span> ?=
                <span class="hljs-attribute">constructorCloneOf</span>: values
                <span class="hljs-attribute">tag</span>: <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span> clone of (<span class="hljs-subst">#{values.toString()}</span>)"</span>
            arr = values.getValues()
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> _.isArray values
            arr = values
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> values?
            arr = []
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@constructor</span>}</span> values argument must be a List or
                array. Got: <span class="hljs-subst">#{values}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Check for undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> arr
            <span class="hljs-keyword">if</span> v <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Can't have undefined value in List"</span>

        <span class="hljs-keyword">if</span> options?.creator <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span>
            <span class="hljs-property">@creator</span> = Tracker.currentComputation
        <span class="hljs-keyword">else</span>
            <span class="hljs-property">@creator</span> = options.creator
        <span class="hljs-property">@fineGrained</span> = options?.fineGrained ? <span class="hljs-literal">true</span>
        <span class="hljs-property">@onChange</span> = options?.onChange ? <span class="hljs-literal">null</span>

        <span class="hljs-property">@readOnly</span> = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>compact mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-property">@_valuesVar</span> = J.Var(
            J.Var.wrap v <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> arr

            <span class="hljs-attribute">tag</span>:
                <span class="hljs-attribute">list</span>: @
                <span class="hljs-attribute">tag</span>: <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@toString</span>()}</span> valuesVar"</span>
            <span class="hljs-attribute">creator</span>: <span class="hljs-property">@creator</span>
            <span class="hljs-attribute">wrap</span>: <span class="hljs-literal">false</span>
            <span class="hljs-attribute">onChange</span>:
                <span class="hljs-keyword">if</span> _.isFunction <span class="hljs-property">@onChange</span>
                    (oldValues, newValues) =&gt;
                        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..Math.max oldValues.length, newValues.length]
                            <span class="hljs-keyword">if</span> oldValues[i] <span class="hljs-keyword">isnt</span> newValues[i]
                                <span class="hljs-property">@onChange</span> i, oldValues[i], newValues[i]
        )</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>expanded mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-property">@_arr</span> = <span class="hljs-literal">null</span>
        <span class="hljs-property">@_sizeDep</span> = <span class="hljs-literal">null</span>



    <span class="hljs-attribute">_get</span>: <span class="hljs-function"><span class="hljs-params">(index)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-property">@_valuesVar</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We’re using a J.Var to:</p>
<ul>
<li>throw VALUE_NOT_READY</li>
<li>set an extra dependency for List/Dict creator invalidations</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            J.Var(<span class="hljs-property">@_valuesVar</span>.get()[index]).get()

        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">unless</span> <span class="hljs-property">@_arr</span>[index] <span class="hljs-keyword">instanceof</span> J.Var
                <span class="hljs-property">@_initIndexVar</span> index
            <span class="hljs-property">@_arr</span>[index].get()


    <span class="hljs-attribute">_initIndexVar</span>: <span class="hljs-function"><span class="hljs-params">(index)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Initialize it as not-ready so when we set it
on the next line, it might trigger @onChange.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-property">@_arr</span>[index] = J.Var <span class="hljs-property">@_arr</span>[index],
            <span class="hljs-attribute">creator</span>: <span class="hljs-property">@creator</span>
            <span class="hljs-attribute">tag</span>:
                <span class="hljs-attribute">list</span>: @
                <span class="hljs-attribute">index</span>: index
                <span class="hljs-attribute">tag</span>: <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@toString</span>()}</span>._arr[<span class="hljs-subst">#{index}</span>]"</span>
            <span class="hljs-attribute">onChange</span>:
                <span class="hljs-keyword">if</span> _.isFunction <span class="hljs-property">@onChange</span>
                    <span class="hljs-property">@onChange</span>.bind @, index
                <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>


    <span class="hljs-attribute">_pop</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-keyword">if</span> Tracker.active <span class="hljs-keyword">and</span> <span class="hljs-property">@fineGrained</span>
            <span class="hljs-property">@_setCompact</span> <span class="hljs-literal">false</span>

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_valuesVar</span>?
            values = _.clone Tracker.nonreactive =&gt; <span class="hljs-property">@_valuesVar</span>.get()
            lastValue = values.pop()
            <span class="hljs-property">@_valuesVar</span>.set values
            <span class="hljs-keyword">return</span> J.Var(lastValue).get()

        size = <span class="hljs-property">@_arr</span>.length
        <span class="hljs-keyword">if</span> size <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
            <span class="hljs-literal">undefined</span>
        <span class="hljs-keyword">else</span>
            lastValue = <span class="hljs-literal">undefined</span>
            <span class="hljs-keyword">if</span> <span class="hljs-property">@_arr</span>[size - <span class="hljs-number">1</span>] <span class="hljs-keyword">instanceof</span> J.Var
                lastValue = <span class="hljs-property">@_arr</span>[size - <span class="hljs-number">1</span>]._value
                <span class="hljs-keyword">if</span> lastValue <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span> <span class="hljs-keyword">or</span> lastValue <span class="hljs-keyword">instanceof</span> J.VALUE_NOT_READY
                    lastValue = <span class="hljs-property">@_arr</span>[size - <span class="hljs-number">1</span>]._previousReadyValue
            <span class="hljs-keyword">else</span>
                lastValue = <span class="hljs-property">@_arr</span>[size - <span class="hljs-number">1</span>]

            <span class="hljs-keyword">if</span> lastValue <span class="hljs-keyword">isnt</span> <span class="hljs-literal">undefined</span> <span class="hljs-keyword">and</span> _.isFunction <span class="hljs-property">@onChange</span>
                Tracker.afterFlush =&gt;
                    <span class="hljs-keyword">if</span> <span class="hljs-property">@isActive</span>()
                        <span class="hljs-property">@onChange</span>.call @, size - <span class="hljs-number">1</span>, lastValue, <span class="hljs-literal">undefined</span>
            <span class="hljs-property">@_arr</span>.pop()
            <span class="hljs-property">@_sizeDep</span>?.changed()
            lastValue


    <span class="hljs-attribute">_push</span>: <span class="hljs-function"><span class="hljs-params">(value)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> Tracker.active <span class="hljs-keyword">and</span> <span class="hljs-property">@fineGrained</span>
            <span class="hljs-property">@_setCompact</span> <span class="hljs-literal">false</span>

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_valuesVar</span>?
            values = _.clone Tracker.nonreactive =&gt; <span class="hljs-property">@_valuesVar</span>.get()
            values.push J.Var.wrap value
            <span class="hljs-property">@_valuesVar</span>.set values
            <span class="hljs-keyword">return</span>

        index = <span class="hljs-property">@_arr</span>.length

        <span class="hljs-keyword">if</span> (
            _.isFunction(<span class="hljs-property">@onChange</span>) <span class="hljs-keyword">or</span>
            value <span class="hljs-keyword">instanceof</span> J.List <span class="hljs-keyword">or</span> value <span class="hljs-keyword">instanceof</span> J.Dict <span class="hljs-keyword">or</span>
            _.isArray(value) <span class="hljs-keyword">or</span> J.util.isPlainObject(value) <span class="hljs-keyword">or</span>
            value <span class="hljs-keyword">instanceof</span> J.VALUE_NOT_READY
        )
            <span class="hljs-property">@_arr</span>.push J.makeValueNotReadyObject()
            <span class="hljs-property">@_initIndexVar</span> index
            <span class="hljs-property">@_arr</span>[index].set value
        <span class="hljs-keyword">else</span>
            <span class="hljs-property">@_arr</span>.push value

        <span class="hljs-property">@_sizeDep</span>?.changed()


    <span class="hljs-attribute">_set</span>: <span class="hljs-function"><span class="hljs-params">(index, value)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> Tracker.active <span class="hljs-keyword">and</span> <span class="hljs-property">@fineGrained</span>
            <span class="hljs-property">@_setCompact</span> <span class="hljs-literal">false</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@isActive</span>()
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"Can't set value of inactive <span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span>: <span class="hljs-subst">#{@}</span>"</span>

        size = Tracker.nonreactive =&gt; <span class="hljs-property">@size</span>()
        <span class="hljs-keyword">if</span> index &lt; <span class="hljs-number">0</span>
            index = size + index
        <span class="hljs-keyword">unless</span> <span class="hljs-number">0</span> &lt;= index &lt; size
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"List index out of range"</span>

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_valuesVar</span>?
            values = _.clone Tracker.nonreactive =&gt; <span class="hljs-property">@_valuesVar</span>.get()
            values[index] = J.Var.wrap value
            <span class="hljs-property">@_valuesVar</span>.set values
            <span class="hljs-keyword">return</span> value

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_arr</span>[index] <span class="hljs-keyword">not</span> <span class="hljs-keyword">instanceof</span> J.Var</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>We need a Var to set this object up to invalidate getters
when its creator invalidates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (
                value <span class="hljs-keyword">instanceof</span> J.List <span class="hljs-keyword">or</span> value <span class="hljs-keyword">instanceof</span> J.Dict <span class="hljs-keyword">or</span>
                _.isArray(value) <span class="hljs-keyword">or</span> J.util.isPlainObject(value) <span class="hljs-keyword">or</span>
                value <span class="hljs-keyword">instanceof</span> J.VALUE_NOT_READY
            )
                <span class="hljs-property">@_initIndexVar</span> index

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_arr</span>[index] <span class="hljs-keyword">instanceof</span> J.Var
            <span class="hljs-property">@_arr</span>[index].set value
        <span class="hljs-keyword">else</span>
            <span class="hljs-property">@_arr</span>[index] = value


    <span class="hljs-attribute">_setCompact</span>: <span class="hljs-function"><span class="hljs-params">(compact)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Compact mode:
    @_valuesVar is just one array of values; it doesn’t
    try to wrap them in individual Vars or monitor
    individual gets at index-granularity.
Expanded mode:
    @_arr is an array of naked values that get
    promoted to Vars as needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span> compact
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"not implemented yet"</span>
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_arr</span>?

            values = Tracker.nonreactive =&gt; <span class="hljs-property">@getValues</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Invalidate its dependents so they recompute and
get a more granular dependency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-property">@_valuesVar</span>.set <span class="hljs-literal">null</span>
            <span class="hljs-property">@_valuesVar</span> = <span class="hljs-literal">null</span>

            <span class="hljs-property">@_arr</span> = []
            <span class="hljs-property">@_push</span> value <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values
            <span class="hljs-property">@_sizeDep</span> = <span class="hljs-keyword">new</span> Tracker.Dependency <span class="hljs-property">@creator</span>


    <span class="hljs-attribute">clear</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@pop</span>() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..Tracker.nonreactive -&gt; <span class="hljs-property">@size</span>()]


    <span class="hljs-attribute">clone</span>: <span class="hljs-function"><span class="hljs-params">(options = {})</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Nonreactive because a clone’s fields are their
own new piece of application state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        valuesSnapshot = Tracker.nonreactive =&gt; <span class="hljs-property">@getValues</span>()
        <span class="hljs-property">@constructor</span> valuesSnapshot, _.extend(
            {
                <span class="hljs-attribute">creator</span>: Tracker.currentComputation
                <span class="hljs-attribute">tag</span>:
                    <span class="hljs-attribute">clonedFrom</span>: @
                    <span class="hljs-attribute">tag</span>: <span class="hljs-string">"clone of <span class="hljs-subst">#{<span class="hljs-property">@toString</span>}</span>"</span>
                <span class="hljs-attribute">onChange</span>: <span class="hljs-literal">null</span>
            }
            options
        )


    <span class="hljs-attribute">contains</span>: <span class="hljs-function"><span class="hljs-params">(value)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>The current implementation invalidates somewhat
too much.
We could make the reactivity more efficient by
using a special hashSet of @_containsDeps
(one per value argument), but it would be
tricky to handle calls to @contains(v)
when v isn’t J.Dict.encodeKey-able.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-property">@indexOf</span>(value) &gt;= <span class="hljs-number">0</span>


    <span class="hljs-attribute">debug</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-built_in">console</span>.log <span class="hljs-property">@toString</span>()
        <span class="hljs-keyword">for</span> v, i <span class="hljs-keyword">in</span> arr
            <span class="hljs-built_in">console</span>.group i
            v.debug()
            <span class="hljs-built_in">console</span>.groupEnd()


    <span class="hljs-attribute">deepClone</span>: <span class="hljs-function"><span class="hljs-params">(options = {})</span> -&gt;</span>
        arrSnapshot = Tracker.nonreactive =&gt; <span class="hljs-property">@toArr</span>()
        <span class="hljs-property">@constructor</span> arrSnapshot, _.extend(
            {
                <span class="hljs-attribute">creator</span>: Tracker.currentComputation
                <span class="hljs-attribute">tag</span>:
                    <span class="hljs-attribute">deepClonedFrom</span>: @
                    <span class="hljs-attribute">tag</span>: <span class="hljs-string">"deep clone of <span class="hljs-subst">#{<span class="hljs-property">@toString</span>}</span>"</span>
                <span class="hljs-attribute">onChange</span>: <span class="hljs-literal">null</span>
            }
            options
        )


    <span class="hljs-attribute">deepEquals</span>: <span class="hljs-function"><span class="hljs-params">(other)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Like J.util.deepEquals except returns false if
@ or other have any dead parts (unless the dead parts
are equal by reference)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> @ <span class="hljs-keyword">is</span> other
<span class="hljs-function">
        <span class="hljs-title">deadNodesToIds</span> = <span class="hljs-params">(node)</span> -&gt;</span>
            <span class="hljs-keyword">if</span> node <span class="hljs-keyword">instanceof</span> J.Dict
                <span class="hljs-keyword">if</span> node.isActive()
                    deadNodesToIds node.getFields()
                <span class="hljs-keyword">else</span>
                    node._id
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> node <span class="hljs-keyword">instanceof</span> J.List
                <span class="hljs-keyword">if</span> node.isActive()
                    deadNodesToIds node.getValues()
                <span class="hljs-keyword">else</span>
                    <span class="hljs-keyword">return</span> node._id
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> J.util.isPlainObject node
                ret = {}
                <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> node
                    ret[key] = deadNodesToIds value
                ret
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> _.isArray node
                (deadNodesToIds(v) <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> node)
            <span class="hljs-keyword">else</span>
                node

        J.util.deepEquals deadNodesToIds(@), deadNodesToIds(other)


    <span class="hljs-attribute">extend</span>: <span class="hljs-function"><span class="hljs-params">(values)</span> -&gt;</span>
        size = Tracker.nonreactive =&gt; <span class="hljs-property">@size</span>()
        <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> (Tracker.nonreactive =&gt; <span class="hljs-property">@constructor</span>.unwrap values)
            <span class="hljs-property">@push</span> value


    <span class="hljs-attribute">find</span>: <span class="hljs-function"><span class="hljs-params">(f = _.identity)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]
            x = <span class="hljs-property">@get</span> i
            <span class="hljs-keyword">return</span> x <span class="hljs-keyword">if</span> f x


    <span class="hljs-attribute">filter</span>: <span class="hljs-function"><span class="hljs-params">(f = _.identity)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Parallelize running the filter function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        filterOutputs = <span class="hljs-property">@map</span>(f).getValues()
        filtered = J.List [],
            <span class="hljs-attribute">tag</span>:
                <span class="hljs-attribute">filteredFrom</span>: @
                <span class="hljs-attribute">filterFunc</span>: f
                <span class="hljs-attribute">tag</span>: <span class="hljs-string">"filtered <span class="hljs-subst">#{<span class="hljs-property">@toString</span>()}</span>"</span>
        <span class="hljs-property">@forEach</span> (v, i) -&gt;
            <span class="hljs-keyword">if</span> filterOutputs[i] <span class="hljs-keyword">then</span> filtered.push v
        filtered


    <span class="hljs-attribute">forEach</span>: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Use when f has side effects.
Like @map except:</p>
<ul>
<li>Lets f return undefined</li>
<li>Returns an array, not a List</li>
<li>If any of the iterations throws VALUE_NOT_READY,
the forEach call will throw VALUE_NOT_READY</li>
<li>Invalidates when @getValues() changes,
not when the returned array changes.
  Note: This is currently true of maps
  just because making them coarse-grained
  is saving memory.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        f = J.util._makeKeyFunc f
        ready = <span class="hljs-literal">true</span>
        firstNotReadyError = <span class="hljs-literal">null</span>
        ret = <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]
            <span class="hljs-keyword">try</span>
                value = <span class="hljs-property">@get</span> i
                <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span>
                    <span class="hljs-literal">undefined</span>
                <span class="hljs-keyword">else</span>
                    f value, i
            <span class="hljs-keyword">catch</span> e
                <span class="hljs-keyword">if</span> e <span class="hljs-keyword">instanceof</span> J.VALUE_NOT_READY</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>This is how AutoLists are parallelized. We keep
looping because we want to synchronously register
all the not-ready computations with the data
fetcher that runs during afterFlush.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ready = <span class="hljs-literal">false</span>
                    firstNotReadyError ?= e
                <span class="hljs-keyword">else</span>
                    <span class="hljs-built_in">console</span>.log e.stack
                    <span class="hljs-built_in">console</span>.trace()
                    <span class="hljs-keyword">throw</span> e
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ready <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> firstNotReadyError
        ret


    <span class="hljs-attribute">get</span>: <span class="hljs-function"><span class="hljs-params">(index)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@isActive</span>()
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"Computation <span class="hljs-subst">#{Tracker.currentComputation?._id}</span>
                can't get index <span class="hljs-subst">#{index}</span> of inactive <span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span>: <span class="hljs-subst">#{@}</span>"</span>

        <span class="hljs-keyword">unless</span> _.isNumber(index) <span class="hljs-keyword">and</span> parseInt(index) <span class="hljs-keyword">is</span> index
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"Index must be an int"</span>

        size = Tracker.nonreactive =&gt; <span class="hljs-property">@size</span>()

        <span class="hljs-keyword">if</span> index &lt; <span class="hljs-number">0</span>
            index = size + index

        <span class="hljs-keyword">unless</span> <span class="hljs-number">0</span> &lt;= index &lt; size
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"List index out of range"</span>

        <span class="hljs-property">@_get</span> index


    <span class="hljs-attribute">getConcat</span>: <span class="hljs-function"><span class="hljs-params">(lst)</span> -&gt;</span>
        J.List <span class="hljs-property">@map</span>().getValues().concat <span class="hljs-property">@constructor</span>.unwrap lst


    <span class="hljs-attribute">getReversed</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@map</span> (value, i) =&gt; <span class="hljs-property">@get</span> <span class="hljs-property">@size</span>() - <span class="hljs-number">1</span> - i


    <span class="hljs-attribute">getSorted</span>: <span class="hljs-function"><span class="hljs-params">(keySpec = J.util.sortKeyFunc)</span> -&gt;</span>
        sortKeys = <span class="hljs-property">@map</span>(J.util._makeKeyFunc keySpec).getValues()
        items = _.map <span class="hljs-property">@getValues</span>(), <span class="hljs-function"><span class="hljs-params">(v, i)</span> =&gt;</span> <span class="hljs-attribute">index</span>: i, <span class="hljs-attribute">value</span>: v
        J.List(
            _.map(
                J.util.sortByKey items, <span class="hljs-function"><span class="hljs-params">(item)</span> =&gt;</span> sortKeys[item.index]
                (item) =&gt; item.value
            )
            <span class="hljs-attribute">tag</span>:
                <span class="hljs-attribute">sortedFrom</span>: @
                <span class="hljs-attribute">sortKeySpec</span>: keySpec
                <span class="hljs-attribute">tag</span>: <span class="hljs-string">"sorted <span class="hljs-subst">#{<span class="hljs-property">@toString</span>()}</span>"</span>
        )


    <span class="hljs-attribute">getValues</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@get</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]


    <span class="hljs-attribute">join</span>: <span class="hljs-function"><span class="hljs-params">(separator)</span> -&gt;</span>
        <span class="hljs-property">@map</span>().getValues().join separator


    <span class="hljs-attribute">indexOf</span>: <span class="hljs-function"><span class="hljs-params">(x, equalsFunc = J.util.equals)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]
            y = <span class="hljs-property">@get</span> i
            <span class="hljs-keyword">return</span> i <span class="hljs-keyword">if</span> equalsFunc y, x
        -<span class="hljs-number">1</span>


    <span class="hljs-attribute">isActive</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-keyword">not</span> <span class="hljs-property">@creator</span>?.invalidated


    <span class="hljs-attribute">map</span>: <span class="hljs-function"><span class="hljs-params">(f = _.identity, tag)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Enables parallel fetching</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        f = J.util._makeKeyFunc f
        tag ?= (
            <span class="hljs-attribute">tag</span>: <span class="hljs-string">"mapped(<span class="hljs-subst">#{<span class="hljs-property">@toString</span>()}</span>)"</span>
            <span class="hljs-attribute">sourceList</span>: @
            <span class="hljs-attribute">mapFunc</span>: f
        )
        <span class="hljs-keyword">if</span> <span class="hljs-property">@size</span>() <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
        J.List(
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]
                <span class="hljs-keyword">try</span>
                    value = <span class="hljs-property">@get</span> i
                    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span>
                        <span class="hljs-literal">undefined</span>
                    <span class="hljs-keyword">else</span>
                        mappedValue = f value, i
                        <span class="hljs-keyword">if</span> mappedValue <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span>
                            msg = <span class="hljs-string">"Map function must not return undefined.
                                Return null or J.makeValueNotReadyObject()
                                or use List.forEach() instead."</span>
                            <span class="hljs-built_in">console</span>.error msg
                            <span class="hljs-keyword">throw</span> msg
                        mappedValue
                <span class="hljs-keyword">catch</span> e
                    <span class="hljs-keyword">if</span> e <span class="hljs-keyword">instanceof</span> J.VALUE_NOT_READY</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>This is how AutoLists are parallelized. We keep
looping because we want to synchronously register
all the not-ready computations with the data
fetcher that runs during afterFlush.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        e
                    <span class="hljs-keyword">else</span>
                        <span class="hljs-keyword">throw</span> e
            <span class="hljs-attribute">tag</span>: tag
        )


    <span class="hljs-attribute">push</span>: <span class="hljs-function"><span class="hljs-params">(value)</span> -&gt;</span>
        <span class="hljs-property">@_push</span> value
        <span class="hljs-literal">undefined</span>


    <span class="hljs-attribute">pop</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@_pop</span>()


    <span class="hljs-attribute">reverse</span>: <span class="hljs-function">-&gt;</span>
        reversedArr = Tracker.nonreactive =&gt; <span class="hljs-property">@getReversed</span>().toArr()
        <span class="hljs-property">@set</span> i, reversedArr[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..reversedArr.length]
        <span class="hljs-literal">null</span>


    <span class="hljs-attribute">rFind</span>: <span class="hljs-function"><span class="hljs-params">(f = _.identity)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-property">@size</span>() - <span class="hljs-number">1.</span>.<span class="hljs-number">0</span>]
            x = <span class="hljs-property">@get</span> i
            <span class="hljs-keyword">return</span> x <span class="hljs-keyword">if</span> f x


    <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(index, value)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-property">@readOnly</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span> instance is read-only"</span>

        <span class="hljs-property">@_set</span> index, value


    <span class="hljs-attribute">setReadOnly</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@readOnly</span> = <span class="hljs-literal">true</span>, deep = <span class="hljs-literal">false</span>)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> deep
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..Tracker.nonreactive =&gt; <span class="hljs-property">@size</span>()]
                J.Dict._deepSetReadOnly <span class="hljs-property">@tryGet</span> i


    <span class="hljs-attribute">slice</span>: <span class="hljs-function"><span class="hljs-params">(startIndex, endIndex = <span class="hljs-property">@size</span>())</span> -&gt;</span>
        J.List <span class="hljs-property">@map</span>().getValues().slice startIndex, endIndex


    <span class="hljs-attribute">splice</span>: <span class="hljs-function"><span class="hljs-params">(startIndex, length)</span> -&gt;</span>
        size = Tracker.nonreactive =&gt; <span class="hljs-property">@size</span>()
        startIndex = Math.min startIndex, size
        endIndex = Math.min startIndex + length, size
        length = endIndex - startIndex

        ret = J.List Tracker.nonreactive =&gt;
            <span class="hljs-property">@get</span> i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [startIndex...endIndex]

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [startIndex...size - length]
            <span class="hljs-property">@set</span> i, Tracker.nonreactive =&gt; <span class="hljs-property">@get</span> i + length

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..length]
            <span class="hljs-property">@pop</span>()

        ret


    <span class="hljs-attribute">sort</span>: <span class="hljs-function"><span class="hljs-params">(keySpec = J.util.sortKeyFunc)</span> -&gt;</span>
        sortedArr = Tracker.nonreactive =&gt; <span class="hljs-property">@getSorted</span>(keySpec).toArr()
        <span class="hljs-property">@set</span> i, sortedArr[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..sortedArr.length]
        <span class="hljs-literal">null</span>


    <span class="hljs-attribute">size</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@isActive</span>()
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"Can't get size of inactive <span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span>: <span class="hljs-subst">#{@}</span>"</span>

        <span class="hljs-keyword">if</span> <span class="hljs-property">@_valuesVar</span>?
            <span class="hljs-property">@_valuesVar</span>.get().length
        <span class="hljs-keyword">else</span>
            <span class="hljs-property">@_sizeDep</span>.depend()
            <span class="hljs-property">@_arr</span>.length


    <span class="hljs-attribute">toArr</span>: <span class="hljs-function">-&gt;</span>
        values = <span class="hljs-property">@getValues</span>()

        arr = []
        <span class="hljs-keyword">for</span> value, i <span class="hljs-keyword">in</span> values
            <span class="hljs-keyword">if</span> value <span class="hljs-keyword">instanceof</span> J.Dict
                arr.push value.toObj()
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> value <span class="hljs-keyword">instanceof</span> J.List
                arr.push value.toArr()
            <span class="hljs-keyword">else</span>
                arr.push value
        arr


    <span class="hljs-attribute">tryGetValues</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@tryGet</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-property">@size</span>()]


    <span class="hljs-attribute">tryToArr</span>: <span class="hljs-function">-&gt;</span>
        values = <span class="hljs-property">@tryGetValues</span>()

        arr = []
        <span class="hljs-keyword">for</span> value, i <span class="hljs-keyword">in</span> values
            <span class="hljs-keyword">if</span> value <span class="hljs-keyword">instanceof</span> J.Dict
                arr.push value.tryToObj()
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> value <span class="hljs-keyword">instanceof</span> J.List
                arr.push value.tryToArr()
            <span class="hljs-keyword">else</span>
                arr.push value
        arr


    <span class="hljs-attribute">toString</span>: <span class="hljs-function">-&gt;</span>
        s = <span class="hljs-string">"List[<span class="hljs-subst">#{<span class="hljs-property">@_id</span>}</span>]"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-property">@tag</span> <span class="hljs-keyword">then</span> s += <span class="hljs-string">"(<span class="hljs-subst">#{J.util.stringifyTag <span class="hljs-property">@tag</span>}</span>)"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@isActive</span>() <span class="hljs-keyword">then</span> s += <span class="hljs-string">" (inactive)"</span>
        s


    <span class="hljs-attribute">tryGet</span>: <span class="hljs-function"><span class="hljs-params">(index, defaultValue)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> index &lt; <span class="hljs-property">@size</span>()
            ret = J.tryGet =&gt; <span class="hljs-property">@get</span> index
            <span class="hljs-keyword">if</span> ret <span class="hljs-keyword">is</span> <span class="hljs-literal">undefined</span> <span class="hljs-keyword">then</span> defaultValue <span class="hljs-keyword">else</span> ret
        <span class="hljs-keyword">else</span>
            <span class="hljs-literal">undefined</span>


    <span class="hljs-property">@unwrap</span>: <span class="hljs-function"><span class="hljs-params">(listOrArr)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> listOrArr <span class="hljs-keyword">instanceof</span> J.List
            listOrArr.getValues()
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> _.isArray listOrArr
            listOrArr
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span> can't unwrap <span class="hljs-subst">#{listOrArr}</span>"</span>


    <span class="hljs-property">@wrap</span>: <span class="hljs-function"><span class="hljs-params">(listOrArr)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> listOrArr <span class="hljs-keyword">instanceof</span> @
            listOrArr
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> _.isArray listOrArr
            @ listOrArr
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Meteor.Error <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@constructor</span>.name}</span> can't wrap <span class="hljs-subst">#{listOrArr}</span>"</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="http://fuelyourcoding.com/scripts/toc/js/jquery.tableofcontents.min.js"></script>
  <script>
    $(function () {
      $("h1").first().after("<ul id='toc'>").after("<hr>");
      $("#toc").after("<hr>").tableOfContents(null, {
        startLevel: 2,
        depth: 10
      });
    });
  </script>
</body>
</html>
